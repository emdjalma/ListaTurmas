<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turmas - Lista de Alunos</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Comic+Neue:wght@400;700&display=swap');

        body {
            background-color: #f0f8ff;
            background-image: radial-gradient(#FFD700 2px, transparent 2px), radial-gradient(#FF69B4 2px, transparent 2px);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            font-family: 'Comic Neue', cursive, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .main-header {
            text-align: center;
            background-color: #fff;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 5px solid #FFB6C1;
            max-width: 1000px;
            margin: 0 auto 30px auto;
        }

        .school-name {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.4em;
            color: #555;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        /* Grade para acomodar as 8 turmas */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .turma-card {
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            border: 5px solid #87CEEB;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .card-header {
            background-color: #87CEEB;
            padding: 15px;
            text-align: center;
            color: #fff;
        }

        .class-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 2.5em;
            text-shadow: 2px 2px 0px #4682B4;
            margin: 0;
        }

        .info-bar {
            background-color: #98FB98;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            color: #006400;
            font-size: 1.1em;
            border-bottom: 2px dashed #fff;
        }

        .table-container {
            flex-grow: 1;
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: #FFD700;
            color: #d35400;
            position: sticky;
            top: 0;
        }

        th {
            padding: 10px;
            text-align: left;
            font-family: 'Fredoka', sans-serif;
            font-size: 1.1em;
        }

        td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            color: #444;
            font-size: 1.1em;
        }

        tbody tr:nth-child(even) { background-color: #F0FFFF; }
        tbody tr:hover { background-color: #FFFACD; }

        .gender-icon {
            display: inline-block;
            width: 25px;
            text-align: center;
            border-radius: 50%;
            color: white;
            font-size: 0.8em;
            padding: 2px 0;
            margin-right: 8px;
        }

        .girl { background-color: #FF69B4; }
        .boy { background-color: #4682B4; }
        .unknown { background-color: #A9A9A9; }

        #loading {
            text-align: center;
            font-size: 1.5em;
            color: #555;
            width: 100%;
            margin-top: 50px;
            font-family: 'Fredoka', sans-serif;
        }
    </style>
</head>
<body>

    <div class="main-header">
        <div class="school-name">Secretaria Municipal de Educa√ß√£o - Suzano</div>
        <div class="school-name" style="color: #4682B4; font-size: 1.8em;">E.M. Djalma dos Santos Paiva</div>
        <p style="color: #888; font-family: 'Fredoka', sans-serif; margin-top: 10px;">Painel Geral de Turmas</p>
    </div>

    <div id="loading">Buscando dados na planilha... üß∏</div>
    
    <div class="grid-container" id="container-turmas">
        </div>

    <script>
        // =========================================================================
        // 1. CONFIGURA√á√ïES DA PLANILHA
        // =========================================================================
        
        // Substitua pelo link CSV gerado em "Publicar na Web"
        const urlPlanilha = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTuvTa-yPFRwMpGNR3auk26l6H5AizYlQjQjgiJ_IV03VpKOGzEcO4Sj-Gx0UcxBUp8sGXeXYg1MyJI/pub?output=csv'; 

        // Defina os nomes exatos das 3 colunas da sua planilha
        const colTurma = 'Turma';
        const colNome = 'Nome';
        const colSexo = 'Sexo';

        // =========================================================================
        // 2. L√ìGICA DE CARREGAMENTO E AGRUPAMENTO
        // =========================================================================

        async function carregarDados() {
            try {
                // Adiciona um timestamp na URL para "enganar" o cache do navegador
const separador = urlPlanilha.includes('?') ? '&' : '?';
const urlSemCache = `${urlPlanilha}${separador}t=${new Date().getTime()}`;

// Faz a requisi√ß√£o for√ßando ignorar o cache local
const response = await fetch(urlSemCache, { cache: "no-store" });

                // Faz o parse do CSV
                const linhas = textData.split('\n').map(linha => {
                    return linha.split(',').map(item => item.replace(/(^"|"$)/g, '').trim());
                });

                const cabecalhos = linhas[0];
                
                // Encontra os √≠ndices dinamicamente (ignorando mai√∫sculas/min√∫sculas)
                const getIndex = (nomeColuna) => cabecalhos.findIndex(c => c.toLowerCase() === nomeColuna.toLowerCase());
                
                const idxTurma = getIndex(colTurma);
                const idxNome = getIndex(colNome);
                const idxSexo = getIndex(colSexo);

                if (idxTurma === -1 || idxNome === -1 || idxSexo === -1) {
                    throw new Error('As colunas especificadas n√£o foram encontradas no cabe√ßalho.');
                }

                // Objeto para agrupar os alunos por turma
                const agrupamentoTurmas = {};

                // Percorre os dados agrupando pela coluna "Turma"
                for (let i = 1; i < linhas.length; i++) {
                    const colunas = linhas[i];
                    if (colunas.length < 3 || !colunas[idxNome]) continue; // Pula linhas vazias

                    const turma = colunas[idxTurma] || 'Sem Turma Definida';
                    const nome = colunas[idxNome];
                    const sexo = colunas[idxSexo] ? colunas[idxSexo].toUpperCase() : '';

                    if (!agrupamentoTurmas[turma]) {
                        agrupamentoTurmas[turma] = [];
                    }
                    
                    agrupamentoTurmas[turma].push({ nome, sexo });
                }

                renderizarTurmas(agrupamentoTurmas);

            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('loading').innerHTML = `<span style="color: red;">Erro ao carregar os dados. Verifique o link e os nomes das colunas.</span>`;
            }
        }

        // =========================================================================
        // 3. L√ìGICA DE RENDERIZA√á√ÉO NA TELA
        // =========================================================================

        function renderizarTurmas(turmasData) {
            const container = document.getElementById('container-turmas');
            const loading = document.getElementById('loading');
            
            container.innerHTML = '';
            loading.style.display = 'none'; // Esconde a mensagem de carregamento

            // Pega o nome de todas as turmas e ordena em ordem alfab√©tica
            const nomesDasTurmas = Object.keys(turmasData).sort();

            nomesDasTurmas.forEach(nomeTurma => {
                const alunos = turmasData[nomeTurma];
                
                // Ordena os alunos por ordem alfab√©tica dentro da turma
                alunos.sort((a, b) => a.nome.localeCompare(b.nome));

                // Monta as linhas da tabela para esta turma
                let linhasTabela = '';
                alunos.forEach((aluno, index) => {
                    let classeSexo = 'unknown';
                    let icone = '-';
                    
                    if (aluno.sexo === 'F' || aluno.sexo === 'FEMININO' || aluno.sexo === 'FEMININA') {
                        classeSexo = 'girl';
                        icone = '‚ôÄ';
                    } else if (aluno.sexo === 'M' || aluno.sexo === 'MASCULINO') {
                        classeSexo = 'boy';
                        icone = '‚ôÇ';
                    }

                    linhasTabela += `
                        <tr>
                            <td style="text-align: center; width: 40px;">${index + 1}</td>
                            <td><span class="gender-icon ${classeSexo}">${icone}</span> ${aluno.nome}</td>
                        </tr>
                    `;
                });

                // Cria o Card HTML da Turma
                const cardHTML = `
                    <div class="turma-card">
                        <div class="card-header">
                            <h2 class="class-title">${nomeTurma}</h2>
                        </div>
                        <div class="info-bar">
                            üë∂ ${alunos.length} Alunos
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="text-align: center;">#</th>
                                        <th>Nome da Crian√ßa</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${linhasTabela}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;

                // Injeta o card na tela
                container.innerHTML += cardHTML;
            });
        }

        // Executa a fun√ß√£o ao carregar a p√°gina
        window.onload = carregarDados;
    </script>
</body>
</html>

